<div class="flex h-[calc(100vh-8rem)] min-h-0 bg-gray-50 rounded-lg shadow-lg overflow-hidden">
  <!-- Conversations List -->
  <div class="w-80 h-full min-h-0 bg-white border-r border-gray-200 flex flex-col">
    <!-- Header -->
    <div class="p-4 border-b border-gray-200 bg-indigo-600">
      <h2 class="text-xl font-bold text-white">Messages</h2>
      <p class="text-indigo-100 text-sm mt-1">{{ conversations().length }} conversations</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading()" class="flex-1 flex items-center justify-center">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading() && conversations().length === 0" class="flex-1 flex items-center justify-center p-6">
      <div class="text-center">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        <p class="text-gray-600 font-medium">No conversations yet</p>
        <p class="text-gray-500 text-sm mt-2">Start matching to chat with others</p>
      </div>
    </div>

    <!-- Conversations List -->
    <div *ngIf="!isLoading() && conversations().length > 0" class="flex-1 overflow-y-auto conversations-scroll" style="min-height: 0; max-height: 100%;">
      <div *ngFor="let conversation of conversations()"
           (click)="selectConversation(conversation)"
           [class.bg-indigo-50]="selectedConversation()?.id === conversation.id"
           [class.border-l-4]="selectedConversation()?.id === conversation.id"
           [class.border-indigo-600]="selectedConversation()?.id === conversation.id"
           class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition">
        <div class="flex items-start justify-between">
          <div class="flex-1 min-w-0">
            <h3 class="font-semibold text-gray-900 truncate">{{ getOtherParticipantName(conversation) }}</h3>
            <p *ngIf="conversation.lastMessage" class="text-sm text-gray-600 truncate mt-1">
              {{ conversation.lastMessage }}
            </p>
            <p *ngIf="!conversation.lastMessage" class="text-sm text-gray-400 italic mt-1">No messages yet</p>
          </div>
          <span class="text-xs text-gray-500 ml-2 shrink-0">{{ formatDate(conversation.updatedAt) }}</span>
        </div>
        <div *ngIf="conversation.unreadBy.includes(currentUserId())" class="mt-2">
          <span class="inline-block bg-indigo-600 text-white text-xs px-2 py-1 rounded-full">New</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages Area -->
  <div class="flex-1 h-full min-h-0 flex flex-col bg-white">
    <!-- No Conversation Selected -->
    <div *ngIf="!selectedConversation()" class="flex-1 flex items-center justify-center bg-gray-50">
      <div class="text-center">
        <svg class="w-24 h-24 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">Select a conversation</h3>
        <p class="text-gray-500">Choose a conversation from the list to start messaging</p>
      </div>
    </div>

    <!-- Chat Area -->
    <div *ngIf="selectedConversation()" class="flex-1 min-h-0 flex flex-col">
      <!-- Chat Header -->
      <div class="p-4 border-b border-gray-200 bg-white shadow-sm">
        <div class="flex items-center">
          <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold mr-3">
            {{ getOtherParticipantName(selectedConversation()!).charAt(0).toUpperCase() }}
          </div>
          <div>
            <h3 class="font-semibold text-gray-900">{{ getOtherParticipantName(selectedConversation()!) }}</h3>
            <p class="text-sm text-gray-500">Active now</p>
          </div>
        </div>
      </div>

      <!-- Messages -->
      <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 messages-container" style="min-height: 0; max-height: 100%;">
        <div *ngIf="messages().length === 0" class="text-center py-8">
          <p class="text-gray-500">No messages yet. Say hi! ðŸ‘‹</p>
        </div>

        <div *ngFor="let message of messages()"
             [class.justify-end]="isMyMessage(message)"
             class="flex">
          <div [class.bg-indigo-600]="isMyMessage(message)"
               [class.text-white]="isMyMessage(message)"
               [class.bg-white]="!isMyMessage(message)"
               [class.text-gray-900]="!isMyMessage(message)"
               class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg shadow">
            <p class="wrap-break-words">{{ message.content }}</p>
            <p [class.text-indigo-100]="isMyMessage(message)"
               [class.text-gray-500]="!isMyMessage(message)"
               class="text-xs mt-1">{{ formatTime(message.createdAt) }}</p>
          </div>
        </div>
      </div>

      <!-- Message Input -->
      <div class="p-4 border-t border-gray-200 bg-white">
        <div class="flex gap-2">
          <input
            type="text"
            [(ngModel)]="newMessage"
            (keypress)="onKeyPress($event)"
            placeholder="Type a message..."
            class="flex-1 px-4 py-3 border text-gray-700 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-transparent"
          />
          <button
            (click)="sendMessage()"
            [disabled]="!newMessage().trim()"
            class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-medium">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
